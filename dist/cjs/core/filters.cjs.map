{"version":3,"file":"filters.cjs","sources":["../../../src/core/filters.ts"],"sourcesContent":["/**\n * E-Commerce Filtering System\n * Works with multi-field search results to filter by ranges, terms, and booleans\n */\n\nimport type { SuggestionResult } from \"./types.js\";\n\n/**\n * Range filter for numeric fields\n */\nexport interface RangeFilter {\n  field: string;\n  min?: number;\n  max?: number;\n}\n\n/**\n * Term filter for categorical fields\n */\nexport interface TermFilter {\n  field: string;\n  values: any[];\n  operator?: \"AND\" | \"OR\";\n}\n\n/**\n * Boolean filter\n */\nexport interface BooleanFilter {\n  field: string;\n  value: boolean;\n}\n\n/**\n * Combined filter options\n */\nexport interface FilterOptions {\n  ranges?: RangeFilter[];\n  terms?: TermFilter[];\n  booleans?: BooleanFilter[];\n}\n\n/**\n * Apply filters to search results\n * Works with result.fields property populated by multi-field search\n */\nexport function applyFilters(results: SuggestionResult[], filters: FilterOptions): SuggestionResult[] {\n  let filtered = results;\n\n  if (filters.ranges && filters.ranges.length > 0) {\n    filtered = filtered.filter((result) => {\n      if (!result.fields) return true;\n      \n      return filters.ranges!.every((range) => {\n        const value = result.fields![range.field];\n        if (value === undefined) return true;\n        \n        const numValue = Number(value);\n        if (isNaN(numValue)) return true;\n        \n        if (range.min !== undefined && numValue < range.min) return false;\n        if (range.max !== undefined && numValue > range.max) return false;\n        \n        return true;\n      });\n    });\n  }\n\n  if (filters.terms && filters.terms.length > 0) {\n    filtered = filtered.filter((result) => {\n      if (!result.fields) return true;\n      \n      return filters.terms!.every((term) => {\n        const value = result.fields![term.field];\n        if (value === undefined) return true;\n        \n        const operator = term.operator || \"OR\";\n        \n        if (operator === \"OR\") {\n          return term.values.some((filterValue) => matchValue(value, filterValue));\n        } else {\n          // AND for array fields\n          if (Array.isArray(value)) {\n            return term.values.every((filterValue) =>\n              value.some((v) => matchValue(v, filterValue))\n            );\n          }\n          return term.values.some((filterValue) => matchValue(value, filterValue));\n        }\n      });\n    });\n  }\n\n  if (filters.booleans && filters.booleans.length > 0) {\n    filtered = filtered.filter((result) => {\n      if (!result.fields) return true;\n      \n      return filters.booleans!.every((boolFilter) => {\n        const value = result.fields![boolFilter.field];\n        if (value === undefined) return true;\n        \n        const boolValue = typeof value === \"boolean\" ? value : String(value) === \"true\" || Number(value) === 1;\n        \n        return boolValue === boolFilter.value;\n      });\n    });\n  }\n\n  return filtered;\n}\n\nfunction matchValue(value: any, filterValue: any): boolean {\n  if (value === filterValue) return true;\n  \n  if (typeof value === \"string\" && typeof filterValue === \"string\") {\n    return value.toLowerCase() === filterValue.toLowerCase();\n  }\n  \n  const numValue = Number(value);\n  const numFilterValue = Number(filterValue);\n  if (!isNaN(numValue) && !isNaN(numFilterValue)) {\n    return numValue === numFilterValue;\n  }\n  \n  return false;\n}\n"],"names":[],"mappings":";;AA8CO,SAAS,aAAa,SAA6B,SAA4C;AACpG,MAAI,WAAW;AAEf,MAAI,QAAQ,UAAU,QAAQ,OAAO,SAAS,GAAG;AAC/C,eAAW,SAAS,OAAO,CAAC,WAAW;AACrC,UAAI,CAAC,OAAO,OAAQ,QAAO;AAE3B,aAAO,QAAQ,OAAQ,MAAM,CAAC,UAAU;AACtC,cAAM,QAAQ,OAAO,OAAQ,MAAM,KAAK;AACxC,YAAI,UAAU,OAAW,QAAO;AAEhC,cAAM,WAAW,OAAO,KAAK;AAC7B,YAAI,MAAM,QAAQ,EAAG,QAAO;AAE5B,YAAI,MAAM,QAAQ,UAAa,WAAW,MAAM,IAAK,QAAO;AAC5D,YAAI,MAAM,QAAQ,UAAa,WAAW,MAAM,IAAK,QAAO;AAE5D,eAAO;AAAA,MACT,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAEA,MAAI,QAAQ,SAAS,QAAQ,MAAM,SAAS,GAAG;AAC7C,eAAW,SAAS,OAAO,CAAC,WAAW;AACrC,UAAI,CAAC,OAAO,OAAQ,QAAO;AAE3B,aAAO,QAAQ,MAAO,MAAM,CAAC,SAAS;AACpC,cAAM,QAAQ,OAAO,OAAQ,KAAK,KAAK;AACvC,YAAI,UAAU,OAAW,QAAO;AAEhC,cAAM,WAAW,KAAK,YAAY;AAElC,YAAI,aAAa,MAAM;AACrB,iBAAO,KAAK,OAAO,KAAK,CAAC,gBAAgB,WAAW,OAAO,WAAW,CAAC;AAAA,QACzE,OAAO;AAEL,cAAI,MAAM,QAAQ,KAAK,GAAG;AACxB,mBAAO,KAAK,OAAO;AAAA,cAAM,CAAC,gBACxB,MAAM,KAAK,CAAC,MAAM,WAAW,GAAG,WAAW,CAAC;AAAA,YAAA;AAAA,UAEhD;AACA,iBAAO,KAAK,OAAO,KAAK,CAAC,gBAAgB,WAAW,OAAO,WAAW,CAAC;AAAA,QACzE;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAEA,MAAI,QAAQ,YAAY,QAAQ,SAAS,SAAS,GAAG;AACnD,eAAW,SAAS,OAAO,CAAC,WAAW;AACrC,UAAI,CAAC,OAAO,OAAQ,QAAO;AAE3B,aAAO,QAAQ,SAAU,MAAM,CAAC,eAAe;AAC7C,cAAM,QAAQ,OAAO,OAAQ,WAAW,KAAK;AAC7C,YAAI,UAAU,OAAW,QAAO;AAEhC,cAAM,YAAY,OAAO,UAAU,YAAY,QAAQ,OAAO,KAAK,MAAM,UAAU,OAAO,KAAK,MAAM;AAErG,eAAO,cAAc,WAAW;AAAA,MAClC,CAAC;AAAA,IACH,CAAC;AAAA,EACH;AAEA,SAAO;AACT;AAEA,SAAS,WAAW,OAAY,aAA2B;AACzD,MAAI,UAAU,YAAa,QAAO;AAElC,MAAI,OAAO,UAAU,YAAY,OAAO,gBAAgB,UAAU;AAChE,WAAO,MAAM,kBAAkB,YAAY,YAAA;AAAA,EAC7C;AAEA,QAAM,WAAW,OAAO,KAAK;AAC7B,QAAM,iBAAiB,OAAO,WAAW;AACzC,MAAI,CAAC,MAAM,QAAQ,KAAK,CAAC,MAAM,cAAc,GAAG;AAC9C,WAAO,aAAa;AAAA,EACtB;AAEA,SAAO;AACT;;"}