(function(m,k){typeof exports=="object"&&typeof module<"u"?k(exports):typeof define=="function"&&define.amd?define(["exports"],k):(m=typeof globalThis<"u"?globalThis:m||self,k(m.FuzzyFindJS={}))})(this,(function(m){"use strict";const k={languages:["english"],features:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"],performance:"balanced",maxResults:10,minQueryLength:2,fuzzyThreshold:.75,maxEditDistance:2,ngramSize:3},U={fast:{performance:"fast",features:["partial-words","missing-letters"],maxEditDistance:1,fuzzyThreshold:.9,maxResults:3},balanced:{performance:"balanced",features:["phonetic","partial-words","missing-letters","keyboard-neighbors"],maxEditDistance:2,fuzzyThreshold:.75,maxResults:5},comprehensive:{performance:"comprehensive",features:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"],maxEditDistance:3,fuzzyThreshold:.7,maxResults:10}},H={german:["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"],english:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","transpositions"],spanish:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters"],french:["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters"]};function $(t={}){const e={...k};if(t.performance&&t.performance!=="balanced"){const n=U[t.performance];Object.assign(e,n)}const s={...e,...t};if(!t.features&&t.languages){const n=new Set;for(const a of t.languages)(H[a]||H.english).forEach(i=>n.add(i));s.features=Array.from(n)}return s}function ue(t){if(t.maxResults<1)throw new Error("maxResults must be at least 1");if(t.minQueryLength<1)throw new Error("minQueryLength must be at least 1");if(t.fuzzyThreshold<0||t.fuzzyThreshold>1)throw new Error("fuzzyThreshold must be between 0 and 1");if(t.maxEditDistance<0)throw new Error("maxEditDistance must be non-negative");if(t.ngramSize<2)throw new Error("ngramSize must be at least 2");if(t.languages.length===0)throw new Error("At least one language must be specified")}class T{normalize(e){return e.toLowerCase().trim().replace(/\s+/g," ")}getPhoneticCode(e){const s=this.normalize(e);if(s.length===0)return"";let n=s[0].toUpperCase();const a={b:"1",f:"1",p:"1",v:"1",c:"2",g:"2",j:"2",k:"2",q:"2",s:"2",x:"2",z:"2",d:"3",t:"3",l:"4",m:"5",n:"5",r:"6"};for(let r=1;r<s.length&&n.length<4;r++){const i=s[r],o=a[i];o&&o!==n[n.length-1]&&(n+=o)}return n.padEnd(4,"0")}splitCompoundWords(e){return[e]}getWordVariants(e){const s=new Set,n=this.normalize(e);s.add(n),s.add(e);const a=this.getCommonEndings();for(const r of a)n.endsWith(r)&&n.length>r.length+2&&s.add(n.slice(0,-r.length));if(n.length>4)for(let r=3;r<n.length;r++)s.add(n.slice(0,r));return Array.from(s)}getCommonEndings(){return["s","es","ed","ing","er","est"]}getSynonyms(e){return[]}isValidSubstitution(e,s){const a=this.getKeyboardNeighbors()[e.toLowerCase()];return a?a.includes(s.toLowerCase()):!1}getKeyboardNeighbors(){return{q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","y","f","g","h"],y:["t","u","g","h","j"],u:["y","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l"],p:["o","l"],a:["q","w","s","z","x"],s:["q","w","e","a","d","z","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n","m"],j:["y","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k"],z:["a","s","x"],x:["a","s","d","z","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]}}generateNgrams(e,s=3){const n=this.normalize(e);if(n.length<s)return[n];const a=[];for(let r=0;r<=n.length-s;r++)a.push(n.slice(r,r+s));return a}calculateEditDistance(e,s){const n=[],a=e.length,r=s.length;for(let i=0;i<=a;i++)n[i]=[i];for(let i=0;i<=r;i++)n[0][i]=i;for(let i=1;i<=a;i++)for(let o=1;o<=r;o++){const c=e[i-1]===s[o-1]?0:1;n[i][o]=Math.min(n[i-1][o]+1,n[i][o-1]+1,n[i-1][o-1]+c)}return n[a][r]}}class L extends T{language="german";displayName="Deutsch";supportedFeatures=["phonetic","compound","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(e){return e.toLowerCase().trim().replace(/\s+/g," ").replace(/ä/g,"ae").replace(/ö/g,"oe").replace(/ü/g,"ue").replace(/ß/g,"ss")}getPhoneticCode(e){const s=this.normalize(e);if(s.length===0)return"";let n="",a="";for(let r=0;r<s.length;r++){const i=s[r],o=r<s.length-1?s[r+1]:"";let c="";switch(i){case"a":case"e":case"i":case"j":case"o":case"u":case"y":c="0";break;case"h":continue;case"b":case"p":c="1";break;case"d":case"t":o==="c"||o==="s"||o==="z"?c="8":c="2";break;case"f":case"v":case"w":c="3";break;case"g":case"k":case"q":c="4";break;case"c":r===0?o==="a"||o==="h"||o==="k"||o==="l"||o==="o"||o==="q"||o==="r"||o==="u"||o==="x"?c="4":c="8":a==="s"||a==="z"?c="8":o==="h"||o==="k"||o==="q"?c="4":c="8";break;case"x":a==="c"||a==="k"||a==="q"?c="8":c="48";break;case"l":c="5";break;case"m":case"n":c="6";break;case"r":c="7";break;case"s":case"z":c="8";break;default:continue}c&&c!==a&&(n+=c),a=c}return n||"0"}splitCompoundWords(e){const s=this.normalize(e);if(s.length<6)return[e];const n=[],a=this.getCommonPrefixes(),r=this.getCommonSuffixes(),i=this.getCommonWords();for(const o of a)if(s.startsWith(o)&&s.length>o.length+3){const c=s.slice(o.length);n.push(o),n.push(...this.splitCompoundWords(c));break}if(n.length===0){for(const o of r)if(s.endsWith(o)&&s.length>o.length+3){const c=s.slice(0,-o.length);n.push(...this.splitCompoundWords(c)),n.push(o);break}}if(n.length===0)for(let o=3;o<=s.length-3;o++){const c=s.slice(0,o),l=s.slice(o);if(i.has(c)&&l.length>=3){n.push(c),n.push(...this.splitCompoundWords(l));break}}return n.length>0?n:[e]}getWordVariants(e){const s=new Set,n=this.normalize(e);s.add(n),s.add(e),this.splitCompoundWords(e).forEach(i=>s.add(this.normalize(i)));const r=this.getCommonEndings();for(const i of r)n.endsWith(i)&&n.length>i.length+2&&s.add(n.slice(0,-i.length));if(n.length>4)for(let i=3;i<n.length;i++)s.add(n.slice(0,i));return Array.from(s)}getCommonEndings(){return["en","e","er","n","r","s","es","t","ung","heit","keit","schaft","chen","lein","lich","ig","isch","bar","los","voll"]}getSynonyms(e){const s={arzt:["doktor","mediziner","doc"],krankenhaus:["spital","klinik","hospital"],schule:["bildungseinrichtung","lehranstalt"],auto:["wagen","fahrzeug","pkw"],haus:["gebaeude","heim","wohnhaus"],strasse:["weg","gasse","allee"],stadt:["ort","gemeinde","ortschaft"],arbeit:["job","beruf","taetigkeit"],geld:["waehrung","kapital","finanzen"],zeit:["dauer","periode","zeitraum"]},n=this.normalize(e);return s[n]||[]}getKeyboardNeighbors(){return{q:["w","a","s"],w:["q","e","a","s","d"],e:["w","r","s","d","f"],r:["e","t","d","f","g"],t:["r","z","f","g","h"],z:["t","u","g","h","j"],u:["z","i","h","j","k"],i:["u","o","j","k","l"],o:["i","p","k","l","oe"],p:["o","ue","l","oe"],ue:["p","ae"],a:["q","w","s","y","x"],s:["q","w","e","a","d","y","x","c"],d:["w","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","z","f","h","v","b","n"],h:["t","z","u","g","j","b","n","m"],j:["z","u","i","h","k","n","m"],k:["u","i","o","j","l","m"],l:["i","o","p","k","oe"],oe:["o","p","ue","l","ae"],ae:["ue","oe"],y:["a","s","x"],x:["a","s","d","y","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b","m"],m:["h","j","k","n"]}}getCommonPrefixes(){return["un","vor","nach","bei","mit","ab","an","auf","aus","ein","gegen","hinter","neben","ueber","unter","zwischen","selbst"]}getCommonSuffixes(){return["haus","platz","strasse","weg","hof","berg","tal","feld","stadt","dorf","heim","werk","bau","anlage","zentrum"]}getCommonWords(){return new Set(["kranken","kinder","frauen","maenner","alt","neu","gross","klein","hoch","tief","lang","kurz","breit","schmal","dick","duenn","stark","schwach","schnell","langsam","heiss","kalt","warm","auto","bahn","bus","zug","flug","schiff","rad","motor","wasser","feuer","erde","luft","licht","schatten","sonne","mond","tag","nacht","morgen","abend","mittag","zeit","jahr","monat"])}}class W extends T{language="english";displayName="English";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters","transpositions"];normalize(e){return e.toLowerCase().trim().replace(/\s+/g," ").replace(/won't/g,"will not").replace(/can't/g,"cannot").replace(/n't/g," not").replace(/'re/g," are").replace(/'ve/g," have").replace(/'ll/g," will").replace(/'d/g," would").replace(/'m/g," am").replace(/'/g,"")}getPhoneticCode(e){const s=this.normalize(e).replace(/[^a-z]/g,"");if(s.length===0)return"";let n="",a=0;const r=s.length;for((s.startsWith("gn")||s.startsWith("kn")||s.startsWith("pn")||s.startsWith("wr"))&&(a=1);a<r&&n.length<4;){const i=s[a],o=a+1<r?s[a+1]:"",c=a>0?s[a-1]:"";switch(i){case"a":case"e":case"i":case"o":case"u":a===0&&(n+=i.toUpperCase());break;case"b":a===r-1&&c==="m"||(n+="B");break;case"c":o==="h"?(n+="X",a++):o==="i"||o==="e"||o==="y"?n+="S":n+="K";break;case"d":o==="g"?(n+="J",a++):n+="T";break;case"f":n+="F";break;case"g":o==="h"&&a!==0||(o==="n"?(n+="N",a++):o==="i"||o==="e"||o==="y"?n+="J":n+="K");break;case"h":(a===0||"aeiou".includes(c)||"aeiou".includes(o))&&(n+="H");break;case"j":n+="J";break;case"k":c!=="c"&&(n+="K");break;case"l":n+="L";break;case"m":n+="M";break;case"n":n+="N";break;case"p":o==="h"?(n+="F",a++):n+="P";break;case"q":n+="K";break;case"r":n+="R";break;case"s":o==="h"?(n+="X",a++):n+="S";break;case"t":o==="h"?(n+="0",a++):o==="i"&&a+2<r&&(s[a+2]==="a"||s[a+2]==="o")?n+="X":n+="T";break;case"v":n+="F";break;case"w":"aeiou".includes(o)&&(n+="W");break;case"x":n+="KS";break;case"y":"aeiou".includes(o)&&(n+="Y");break;case"z":n+="S";break}a++}return n||"A"}getWordVariants(e){const s=new Set,n=this.normalize(e);s.add(n),s.add(e);const a=this.getCommonEndings();for(const r of a)n.endsWith(r)&&n.length>r.length+2&&s.add(n.slice(0,-r.length));if(n.endsWith("s")&&n.length>3&&s.add(n.slice(0,-1)),n.endsWith("s")||s.add(n+"s"),n.endsWith("ing")&&n.length>5){const r=n.slice(0,-3);s.add(r),s.add(r+"e")}if(n.endsWith("ed")&&n.length>4){const r=n.slice(0,-2);s.add(r),s.add(r+"e")}if(n.length>4)for(let r=3;r<n.length;r++)s.add(n.slice(0,r));return Array.from(s)}getCommonEndings(){return["s","es","ed","ing","er","est","ly","tion","sion","ness","ment","able","ible","ful","less","ous","ious","al","ial","ic","ive","ary","ery","ory"]}getSynonyms(e){const s={doctor:["physician","medic","doc","md"],hospital:["clinic","medical center","infirmary"],school:["academy","institution","college","university"],car:["vehicle","automobile","auto"],house:["home","residence","dwelling","building"],street:["road","avenue","lane","boulevard"],city:["town","municipality","urban area"],work:["job","employment","occupation","career"],money:["cash","currency","funds","capital"],time:["duration","period","moment","hour"],big:["large","huge","enormous","massive","giant"],small:["little","tiny","miniature","petite"],fast:["quick","rapid","speedy","swift"],slow:["sluggish","gradual","leisurely"],good:["excellent","great","wonderful","fine"],bad:["poor","terrible","awful","horrible"],happy:["joyful","cheerful","glad","pleased"],sad:["unhappy","depressed","melancholy","sorrowful"]},n=this.normalize(e);return s[n]||[]}}class I extends T{language="spanish";displayName="Español";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(e){return e.toLowerCase().trim().replace(/\s+/g," ").replace(/á/g,"a").replace(/é/g,"e").replace(/í/g,"i").replace(/ó/g,"o").replace(/ú/g,"u").replace(/ñ/g,"n").replace(/ü/g,"u")}getPhoneticCode(e){const s=this.normalize(e);if(s.length===0)return"";let n="",a="";for(let r=0;r<s.length;r++){const i=s[r],o=r<s.length-1?s[r+1]:"";let c="";switch(i){case"a":case"e":case"i":case"o":case"u":c="0";break;case"b":case"v":c="1";break;case"c":o==="h"?c="2":o==="e"||o==="i"?c="8":c="4";break;case"d":c="3";break;case"f":c="5";break;case"g":o==="u"&&r+2<s.length&&(s[r+2]==="e"||s[r+2]==="i")?c="4":o==="e"||o==="i"?c="6":c="4";break;case"h":continue;case"j":c="6";break;case"k":c="4";break;case"l":o==="l"?c="7":c="5";break;case"m":c="6";break;case"n":o==="n"?c="7":c="6";break;case"ñ":c="7";break;case"p":c="1";break;case"q":c="4";break;case"r":o==="r"||r===0?c="8":c="7";break;case"s":c="8";break;case"t":c="3";break;case"w":c="1";break;case"x":c="48";break;case"y":c="7";break;case"z":c="8";break;default:continue}c&&c!==a&&(n+=c),a=c}return n||"0"}getCommonEndings(){return["o","a","os","as","e","es","ar","er","ir","ado","ada","idos","idas","ando","endo","iendo","cion","sion","dad","tad","mente","oso","osa","ito","ita","illo","illa"]}getSynonyms(e){const s={medico:["doctor","facultativo"],hospital:["clinica","sanatorio"],escuela:["colegio","instituto"],coche:["auto","automovil","vehiculo"],casa:["hogar","vivienda","domicilio"],calle:["via","avenida","carretera"],ciudad:["urbe","poblacion","municipio"],trabajo:["empleo","ocupacion","labor"],dinero:["plata","efectivo","capital"],tiempo:["momento","periodo","duracion"],grande:["enorme","gigante","inmenso"],pequeno:["chico","diminuto","minusculo"],rapido:["veloz","ligero","acelerado"],lento:["despacio","pausado"],bueno:["excelente","magnifico","estupendo"],malo:["pesimo","terrible","horrible"]},n=this.normalize(e);return s[n]||[]}}class A extends T{language="french";displayName="Français";supportedFeatures=["phonetic","synonyms","keyboard-neighbors","partial-words","missing-letters","extra-letters"];normalize(e){return e.toLowerCase().trim().replace(/\s+/g," ").replace(/[àáâãä]/g,"a").replace(/[èéêë]/g,"e").replace(/[ìíîï]/g,"i").replace(/[òóôõö]/g,"o").replace(/[ùúûü]/g,"u").replace(/ç/g,"c").replace(/ñ/g,"n").replace(/ÿ/g,"y")}getPhoneticCode(e){const s=this.normalize(e);if(s.length===0)return"";let n="",a="";for(let r=0;r<s.length;r++){const i=s[r],o=r<s.length-1?s[r+1]:"",c=r<s.length-2?s[r+2]:"";let l="";switch(i){case"a":case"e":case"i":case"o":case"u":case"y":l="0";break;case"b":l="1";break;case"c":o==="h"?l="2":o==="e"||o==="i"?l="8":l="4";break;case"d":l="3";break;case"f":l="5";break;case"g":o==="n"?l="6":o==="u"&&(c==="e"||c==="i")?l="4":o==="e"||o==="i"?l="6":l="4";break;case"h":r===0&&(l="0");break;case"j":l="6";break;case"k":l="4";break;case"l":l="5";break;case"m":l="6";break;case"n":l="6";break;case"p":o==="h"?l="5":l="1";break;case"q":l="4";break;case"r":l="7";break;case"s":l="8";break;case"t":l="3";break;case"v":l="5";break;case"w":l="5";break;case"x":l="48";break;case"z":l="8";break;default:continue}l&&l!==a&&(n+=l),a=l}return n||"0"}getCommonEndings(){return["e","es","s","x","ent","ant","ment","tion","sion","eur","euse","teur","trice","able","ible","ique","aire","oire","ette","elle","esse","asse","isse","age","isme","iste","ite","ude","ade"]}getSynonyms(e){const s={medecin:["docteur","praticien"],hopital:["clinique","centre medical"],ecole:["etablissement","institution"],voiture:["automobile","vehicule","auto"],maison:["domicile","residence","habitation"],rue:["avenue","boulevard","voie"],ville:["cite","commune","agglomeration"],travail:["emploi","occupation","metier"],argent:["monnaie","especes","capital"],temps:["duree","periode","moment"],grand:["enorme","immense","gigantesque"],petit:["minuscule","minime","reduit"],rapide:["vite","accelere","prompt"],lent:["lentement","doucement"],bon:["excellent","parfait","formidable"],mauvais:["terrible","affreux","horrible"],heureux:["joyeux","content","ravi"],triste:["malheureux","chagrine","melancolique"]},n=this.normalize(e);return s[n]||[]}getKeyboardNeighbors(){return{a:["z","e","r","q","s"],z:["a","e","r","q","s","d"],e:["z","r","t","s","d","f"],r:["e","t","y","d","f","g"],t:["r","y","u","f","g","h"],y:["t","u","i","g","h","j"],u:["y","i","o","h","j","k"],i:["u","o","p","j","k","l"],o:["i","p","k","l","m"],p:["o","l","m"],q:["a","z","s","w","x"],s:["a","z","e","q","d","w","x","c"],d:["z","e","r","s","f","x","c","v"],f:["e","r","t","d","g","c","v","b"],g:["r","t","y","f","h","v","b","n"],h:["t","y","u","g","j","b","n"],j:["y","u","i","h","k","n"],k:["u","i","o","j","l"],l:["i","o","p","k","m"],m:["o","p","l"],w:["q","s","x"],x:["q","s","d","w","c"],c:["s","d","f","x","v"],v:["d","f","g","c","b"],b:["f","g","h","v","n"],n:["g","h","j","b"]}}}class x{static processors=new Map([["german",new L],["english",new W],["spanish",new I],["french",new A]]);static getProcessor(e){return this.processors.get(e.toLowerCase())}static getProcessors(e){return e.map(s=>this.getProcessor(s)).filter(s=>s!==void 0)}static getAvailableLanguages(){return Array.from(this.processors.keys())}static registerProcessor(e){this.processors.set(e.language.toLowerCase(),e)}static isSupported(e){return this.processors.has(e.toLowerCase())}static getProcessorInfo(){return Array.from(this.processors.values()).map(e=>({language:e.language,displayName:e.displayName,supportedFeatures:e.supportedFeatures}))}}const ge=Object.freeze(Object.defineProperty({__proto__:null,BaseLanguageProcessor:T,EnglishProcessor:W,FrenchProcessor:A,GermanProcessor:L,LanguageRegistry:x,SpanishProcessor:I},Symbol.toStringTag,{value:"Module"}));function S(t,e,s=1/0){const n=t.length,a=e.length;if(Math.abs(n-a)>s)return s+1;if(n===0)return a;if(a===0)return n;if(t===e)return 0;let r=new Array(a+1),i=new Array(a+1);for(let o=0;o<=a;o++)r[o]=o;for(let o=1;o<=n;o++){i[0]=o;let c=o;for(let l=1;l<=a;l++){const h=t[o-1]===e[l-1]?0:1;i[l]=Math.min(i[l-1]+1,r[l]+1,r[l-1]+h),c=Math.min(c,i[l])}if(c>s)return s+1;[r,i]=[i,r]}return r[a]}function M(t,e,s=1/0){const n=t.length,a=e.length;if(Math.abs(n-a)>s)return s+1;if(n===0)return a;if(a===0)return n;if(t===e)return 0;const r=Math.max(n,a),i=[],o=r+1;for(let h=0;h<=n+1;h++)i[h]=new Array(a+2).fill(o);i[0][0]=o;for(let h=0;h<=n;h++)i[h+1][0]=o,i[h+1][1]=h;for(let h=0;h<=a;h++)i[0][h+1]=o,i[1][h+1]=h;const c=new Map;for(let h=1;h<=n;h++){let u=0;for(let d=1;d<=a;d++){const g=t[h-1],f=e[d-1],p=c.get(f)||0;let y=1;g===f&&(y=0,u=d),i[h+1][d+1]=Math.min(i[h][d]+y,i[h+1][d]+1,i[h][d+1]+1,i[p][u]+(h-p-1)+1+(d-u-1))}c.set(t[h-1],h)}const l=i[n+1][a+1];return l>s?s+1:l}function F(t,e,s=3){if(t===e)return 1;if(t.length===0||e.length===0)return 0;const n=K(t,s),a=K(e,s);if(n.length===0&&a.length===0)return 1;if(n.length===0||a.length===0)return 0;const r=new Set(n),i=new Set(a),o=new Set([...r].filter(l=>i.has(l))),c=new Set([...r,...i]);return o.size/c.size}function K(t,e){if(t.length<e)return[t];const s=[];for(let n=0;n<=t.length-e;n++)s.push(t.slice(n,n+e));return s}function Q(t,e){return e===0?t===0?1:0:Math.max(0,1-t/e)}function fe(t,e,s=.8,n=2){if(t===e)return!0;const a=Math.max(t.length,e.length);if(Math.abs(t.length-e.length)>n||F(t,e)<s-.2)return!1;const i=S(t,e,n);return Q(i,a)>=s}function de(t,e,s,n){const a=[],r={termToPostings:new Map,phoneticToPostings:new Map,ngramToPostings:new Map,synonymToPostings:new Map,fieldIndices:new Map,totalDocs:0,avgDocLength:0};let i=0,o=0;for(const c of t){if(!c||c.trim().length<s.minQueryLength)continue;const l=c.trim();for(const h of e){const u=h.normalize(l),d=n.has("phonetic")&&h.supportedFeatures.includes("phonetic")?h.getPhoneticCode(l):void 0,g=n.has("compound")&&h.supportedFeatures.includes("compound")?h.splitCompoundWords(l):void 0,f={id:o,word:l,normalized:u,phoneticCode:d,language:h.language,compoundParts:g&&g.length>1?g:void 0};if(a.push(f),i+=u.length,v(r.termToPostings,u,o),v(r.termToPostings,l.toLowerCase(),o),n.has("partial-words")&&h.getWordVariants(l).forEach(w=>{v(r.termToPostings,w,o)}),d&&v(r.phoneticToPostings,d,o),G(u,s.ngramSize).forEach(y=>{v(r.ngramToPostings,y,o)}),g&&g.length>1&&g.forEach(y=>{const w=h.normalize(y);v(r.termToPostings,w,o)}),n.has("synonyms")&&(h.getSynonyms(u).forEach(w=>{v(r.synonymToPostings,w,o)}),s.customSynonyms)){const w=s.customSynonyms[u];w&&w.forEach(P=>{v(r.synonymToPostings,P,o)})}o++}}return r.totalDocs=o,r.avgDocLength=i/Math.max(1,o),{invertedIndex:r,documents:a}}function me(t,e,s,n,a){const r=new Map,i=new Set(a.features);for(const o of n){const c=o.normalize(s.trim());pe(c,t,e,r,o.language),ye(c,t,e,r,o.language),i.has("phonetic")&&o.supportedFeatures.includes("phonetic")&&be(c,o,t,e,r),i.has("synonyms")&&ze(c,t,e,r),we(c,t,e,r,o.language,a.ngramSize),(i.has("missing-letters")||i.has("extra-letters")||i.has("transpositions"))&&ve(c,t,e,r,o,a.maxEditDistance,a)}return Array.from(r.values())}function v(t,e,s){let n=t.get(e);n||(n={term:e,docIds:[]},t.set(e,n)),n.docIds.includes(s)||n.docIds.push(s)}function G(t,e){if(t.length<e)return[t];const s=[];for(let n=0;n<=t.length-e;n++)s.push(t.slice(n,n+e));return s}function pe(t,e,s,n,a){const r=e.termToPostings.get(t);r&&r.docIds.forEach(i=>{const o=s[i];o&&(n.has(i)||n.set(i,{word:o.word,normalized:t,matchType:"exact",editDistance:0,language:a}))})}function ye(t,e,s,n,a){for(const[r,i]of e.termToPostings.entries())r.startsWith(t)&&r!==t&&i.docIds.forEach(o=>{const c=s[o];c&&(n.has(o)||n.set(o,{word:c.word,normalized:r,matchType:"prefix",language:a}))})}function be(t,e,s,n,a){const r=e.getPhoneticCode(t);if(!r)return;const i=s.phoneticToPostings.get(r);i&&i.docIds.forEach(o=>{const c=n[o];c&&(a.has(o)||a.set(o,{word:c.word,normalized:t,matchType:"phonetic",phoneticCode:r,language:e.language}))})}function ze(t,e,s,n){const a=e.synonymToPostings.get(t);a&&a.docIds.forEach(r=>{const i=s[r];i&&(n.has(r)||n.set(r,{word:i.word,normalized:t,matchType:"synonym",language:"synonym"}))})}function we(t,e,s,n,a,r){if(t.length<r)return;const i=G(t,r),o=new Set;i.forEach(c=>{const l=e.ngramToPostings.get(c);l&&l.docIds.forEach(h=>o.add(h))}),o.forEach(c=>{const l=s[c];l&&(n.has(c)||n.set(c,{word:l.word,normalized:t,matchType:"ngram",language:a}))})}function ve(t,e,s,n,a,r,i){for(const[o,c]of e.termToPostings.entries()){if(Math.abs(o.length-t.length)>r)continue;const h=i.features?.includes("transpositions")?M(t,o,r):S(t,o,r);h<=r&&c.docIds.forEach(u=>{const d=s[u];if(!d)return;const g=n.get(u);(!g||(g.editDistance||1/0)>h)&&n.set(u,{word:d.word,normalized:o,matchType:"fuzzy",editDistance:h,language:a.language})})}}function V(t,e,s){const n=[],a=s.toLowerCase(),r=e.toLowerCase();switch(t.matchType){case"exact":n.push({start:0,end:s.length,type:"exact"});break;case"prefix":const i=Math.min(r.length,s.length);n.push({start:0,end:i,type:"prefix"});break;case"substring":const o=a.indexOf(r);o!==-1&&n.push({start:o,end:o+r.length,type:"substring"});break;case"fuzzy":n.push(...ke(r,a,"fuzzy"));break;case"ngram":n.push(...Te(r,a));break;case"phonetic":case"synonym":case"compound":n.push({start:0,end:s.length,type:t.matchType});break}return Se(n)}function ke(t,e,s){const n=[];let a=0,r=0;for(;a<t.length&&r<e.length;)if(t[a]===e[r]){const i=r;let o=r+1;for(a++,r++;a<t.length&&r<e.length&&t[a]===e[r];)o++,a++,r++;n.push({start:i,end:o,type:s})}else r++;return n}function Te(t,e){const s=[];for(let a=0;a<=t.length-3;a++){const r=t.slice(a,a+3);let i=0;for(;;){const o=e.indexOf(r,i);if(o===-1)break;s.push({start:o,end:o+3,type:"ngram"}),i=o+1}}return s}function Se(t){if(t.length===0)return[];const e=[...t].sort((n,a)=>n.start-a.start),s=[e[0]];for(let n=1;n<e.length;n++){const a=e[n],r=s[s.length-1];a.start<=r.end?(r.end=Math.max(r.end,a.end),J(a.type)>J(r.type)&&(r.type=a.type)):s.push(a)}return s}function J(t){return{exact:10,prefix:9,substring:8,fuzzy:7,ngram:6,phonetic:5,compound:4,synonym:3}[t]||0}function Ce(t,e,s="highlight"){if(!e||e.length===0)return E(t);let n="",a=0;for(const r of e){r.start>a&&(n+=E(t.slice(a,r.start)));const i=t.slice(r.start,r.end);n+=`<mark class="${s} ${s}--${r.type}">${E(i)}</mark>`,a=r.end}return a<t.length&&(n+=E(t.slice(a))),n}function E(t){const e=typeof document<"u"?document.createElement("div"):null;return e?(e.textContent=t,e.innerHTML):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}class Y{cache;capacity;constructor(e=100){this.cache=new Map,this.capacity=e}get(e){if(!this.cache.has(e))return;const s=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,s),s}set(e,s){if(this.cache.has(e)&&this.cache.delete(e),this.cache.set(e,s),this.cache.size>this.capacity){const n=this.cache.keys().next().value;n!==void 0&&this.cache.delete(n)}}has(e){return this.cache.has(e)}clear(){this.cache.clear()}get size(){return this.cache.size}getStats(){return{size:this.cache.size,capacity:this.capacity,utilization:this.cache.size/this.capacity}}}class j{cache;hits=0;misses=0;constructor(e=100){this.cache=new Y(e)}getCacheKey(e,s,n){const a=n?JSON.stringify(n):"";return`${e}|${s||"default"}|${a}`}get(e,s,n){const a=this.getCacheKey(e,s,n),r=this.cache.get(a);return r?this.hits++:this.misses++,r}set(e,s,n,a){const r=this.getCacheKey(e,n,a);this.cache.set(r,s)}clear(){this.cache.clear(),this.hits=0,this.misses=0}getStats(){const e=this.cache.getStats(),s=this.hits+this.misses,n=s>0?this.hits/s:0;return{...e,hits:this.hits,misses:this.misses,hitRate:n}}}const X={à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",ā:"a",ă:"a",ą:"a",À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",Ā:"A",Ă:"A",Ą:"A",è:"e",é:"e",ê:"e",ë:"e",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",È:"E",É:"E",Ê:"E",Ë:"E",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ì:"i",í:"i",î:"i",ï:"i",ĩ:"i",ī:"i",ĭ:"i",į:"i",Ì:"I",Í:"I",Î:"I",Ï:"I",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",ō:"o",ŏ:"o",ő:"o",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",Ō:"O",Ŏ:"O",Ő:"O",ù:"u",ú:"u",û:"u",ü:"u",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ù:"U",Ú:"U",Û:"U",Ü:"U",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ý:"y",ÿ:"y",ŷ:"y",Ý:"Y",Ÿ:"Y",Ŷ:"Y",ñ:"n",ń:"n",ņ:"n",ň:"n",Ñ:"N",Ń:"N",Ņ:"N",Ň:"N",ç:"c",ć:"c",ĉ:"c",ċ:"c",č:"c",Ç:"C",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ß:"ss",ð:"d",đ:"d",Ð:"D",Đ:"D",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĥ:"h",ħ:"h",Ĥ:"H",Ħ:"H",ĵ:"j",Ĵ:"J",ķ:"k",Ķ:"K",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ŕ:"r",ŗ:"r",ř:"r",Ŕ:"R",Ŗ:"R",Ř:"R",ś:"s",ŝ:"s",ş:"s",š:"s",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ţ:"t",ť:"t",ŧ:"t",Ţ:"T",Ť:"T",Ŧ:"T",ŵ:"w",Ŵ:"W",ź:"z",ż:"z",ž:"z",Ź:"Z",Ż:"Z",Ž:"Z",æ:"ae",œ:"oe",Æ:"AE",Œ:"OE",þ:"th",Þ:"TH"};function C(t){if(!t)return t;let e="";for(let s=0;s<t.length;s++){const n=t[s];e+=X[n]||n}return e=e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),e}function Pe(t){if(!t)return!1;for(let s=0;s<t.length;s++)if(X[t[s]])return!0;const e=t.normalize("NFD");return/[\u0300-\u036f]/.test(e)}function Me(t){return C(t.toLowerCase())}function Ee(t){const e=C(t);return e!==t?[t,e]:[t]}function Le(t,e){if(!e||e.length===0||typeof t=="string")return null;if(typeof t=="object"&&t!==null){const s={};for(const n of e){const a=t[n];a!=null&&(s[n]=String(a))}return Object.keys(s).length>0?s:null}return null}function We(t,e){const s={};for(const n of t)s[n]=e?.[n]??1;return s}const Z={english:["a","an","and","are","as","at","be","by","for","from","has","he","in","is","it","its","of","on","that","the","to","was","will","with","the","this","but","they","have","had","what","when","where","who","which","why","how"],german:["der","die","das","den","dem","des","ein","eine","einer","eines","einem","einen","und","oder","aber","ist","sind","war","waren","hat","haben","wird","werden","von","zu","im","am","um","auf","für","mit","nach","bei","aus"],spanish:["el","la","los","las","un","una","unos","unas","de","del","y","o","pero","es","son","era","fueron","ha","han","en","a","al","con","por","para","sin","sobre","entre"],french:["le","la","les","un","une","des","du","de","et","ou","mais","est","sont","était","étaient","a","ont","à","au","aux","avec","pour","par","dans","sur","sous","entre"]};function q(t,e){const s=e instanceof Set?e:new Set(e.map(r=>r.toLowerCase())),a=t.split(/\s+/).filter(r=>!s.has(r.toLowerCase()));return a.length===0?t:a.join(" ")}function Ie(t){const e=new Set;for(const s of t){const n=Z[s.toLowerCase()];n&&n.forEach(a=>e.add(a))}return e}function Ae(t,e){return(e instanceof Set?e:new Set(e.map(n=>n.toLowerCase()))).has(t.toLowerCase())}function ee(t,e){if(e===0)return!0;const s=t[e-1];return/[\s\-_.,;:!?()[\]{}'"\/\\]/.test(s)}function te(t,e,s){const n=e+s,a=ee(t,e),r=n>=t.length||/[\s\-_.,;:!?()[\]{}'"\/\\]/.test(t[n]);return a&&r}function ne(t,e,s=!1){const n=[],a=s?t:t.toLowerCase(),r=s?e:e.toLowerCase();let i=0;for(;i<a.length;){const o=a.indexOf(r,i);if(o===-1)break;te(t,o,r.length)&&n.push(o),i=o+1}return n}function N(t,e,s){return s?ne(t,e,!1).length>0:t.toLowerCase().includes(e.toLowerCase())}function xe(t){const s=t.replace(/[.+?^${}()|[\]\\]/g,"\\$&").replace(/\*/g,".*");return new RegExp(`^${s}$`,"i")}function se(t,e){return xe(e).test(t)}function Fe(t){if(!t||typeof t!="string")return{phrases:[],terms:[],original:t||"",hasPhrases:!1};const e=[];let s=t;const n=/"([^"]+)"/g;let a;for(;(a=n.exec(t))!==null;){const o=a[1].trim();o&&o.split(/\s+/).length<=10&&e.push(o)}s=s.replace(/"[^"]*"/g," ");const r=/'([^']+)'/g;for(;(a=r.exec(t))!==null;){const o=a[1].trim();o&&o.split(/\s+/).length<=10&&e.push(o)}s=s.replace(/'[^']*'/g," ");const i=s.split(/\s+/).map(o=>o.trim()).filter(o=>o.length>0);return{phrases:e,terms:i,original:t,hasPhrases:e.length>0}}const je={exactMatch:!1,maxEditDistance:1,proximityBonus:1.5,maxProximityDistance:3,useTranspositions:!1};function Ne(t,e,s={}){const n={...je,...s};if(!t||!e)return{matched:!1,score:0,matchType:"none"};const a=t.toLowerCase(),r=e.toLowerCase(),i=De(a,r);if(i.matched)return{...i,score:1,matchType:"exact"};if(n.exactMatch)return{matched:!1,score:0,matchType:"none"};const o=Be(a,r,n.maxEditDistance,n.useTranspositions);if(o.matched)return{...o,matchType:"fuzzy"};const c=Oe(a,r,n.maxProximityDistance);return c.matched?{...c,matchType:"proximity"}:{matched:!1,score:0,matchType:"none"}}function De(t,e){const s=t.indexOf(e);return s!==-1?{matched:!0,score:1,matchType:"exact",startPos:s,endPos:s+e.length}:{matched:!1,score:0,matchType:"none"}}function Be(t,e,s,n){const a=e.split(/\s+/),r=t.split(/\s+/);for(let i=0;i<=r.length-a.length;i++){const o=r.slice(i,i+a.length);let c=0,l=!0;for(let h=0;h<a.length;h++){const u=n?M(a[h],o[h],s):S(a[h],o[h],s);if(u>s){l=!1;break}c+=u}if(l){const h=a.length*s;return{matched:!0,score:h>0?.7+.2*(1-c/h):.9,matchType:"fuzzy",matchedWords:o}}}return{matched:!1,score:0,matchType:"none"}}function Oe(t,e,s){const n=e.split(/\s+/),a=t.split(/\s+/),r=n.map(()=>[]);if(a.forEach((l,h)=>{n.forEach((u,d)=>{(l===u||l.includes(u)||u.includes(l))&&r[d].push(h)})}),r.some(l=>l.length===0))return{matched:!1,score:0,matchType:"none"};let i=1/0,o=[];function c(l,h){if(l===n.length){const u=[...h].sort((g,f)=>g-f),d=u[u.length-1]-u[0];d<i&&(i=d,o=[...h]);return}for(const u of r[l])c(l+1,[...h,u])}return c(0,[]),i<=s?{matched:!0,score:.5+.2*(1-i/s),matchType:"proximity",matchedWords:o.map(h=>a[h])}:{matched:!1,score:0,matchType:"none"}}function Re(t){if(!t||t.trim().length===0)return["english"];const e=new Set;return e.add("english"),/[äöüßÄÖÜ]/.test(t)&&e.add("german"),/[àâäæçéèêëïîôùûüÿœÀÂÄÆÇÉÈÊËÏÎÔÙÛÜŸŒ]/.test(t)&&e.add("french"),/[áéíóúñüÁÉÍÓÚÑÜ¿¡]/.test(t)&&e.add("spanish"),Array.from(e)}function _e(t,e=100){return t.slice(0,Math.min(e,t.length)).map(n=>typeof n=="string"?n:typeof n=="object"&&n!==null?Object.values(n).filter(a=>typeof a=="string").join(" "):"").join(" ")}function ae(t=[],e={}){const s=e.config?.languages,n=!s||s.includes("auto"),a=$(e.config);if(n){const f=_e(t,100),p=Re(f);a.languages=p}ue(a);const r=new Set(a.features),i=e.languageProcessors||x.getProcessors(a.languages);if(i.length===0)throw new Error(`No language processors found for: ${a.languages.join(", ")}`);const o=e.fields&&e.fields.length>0,c=t.length>0&&typeof t[0]=="object"&&t[0]!==null;if(c&&!o)throw new Error("When indexing objects, you must specify which fields to index via options.fields");const l={base:[],variantToBase:new Map,phoneticToBase:new Map,ngramIndex:new Map,synonymMap:new Map,languageProcessors:new Map,config:a};o&&(l.fields=e.fields,l.fieldWeights=We(e.fields,e.fieldWeights),l.fieldData=new Map),i.forEach(f=>{l.languageProcessors.set(f.language,f)});const h=new Set;let u=0;for(const f of t)if(f){if(o&&c){const p=Le(f,e.fields);if(!p)continue;const y=Object.values(p)[0]||`item_${u}`;l.fieldData.set(y,p);for(const[w,P]of Object.entries(p)){if(!P||P.trim().length<a.minQueryLength)continue;const at=P.trim();h.has(y.toLowerCase())||(h.add(y.toLowerCase()),l.base.push(y));for(const rt of i)He(at,y,w,rt,l,a,r)}}else{const p=typeof f=="string"?f:String(f);if(p.trim().length<a.minQueryLength)continue;const y=p.trim();if(h.has(y.toLowerCase()))continue;h.add(y.toLowerCase()),l.base.push(y);for(const w of i)Ue(y,w,l,a,r)}u++,e.onProgress&&e.onProgress(u,t.length)}if(e.useInvertedIndex||a.useInvertedIndex||t.length>=1e4){const{invertedIndex:f,documents:p}=de(t,i,a,r);l.invertedIndex=f,l.documents=p}if(a.enableCache!==!1){const f=a.cacheSize||100;l._cache=new j(f)}return l}function Ue(t,e,s,n,a){const r=e.normalize(t);z(s.variantToBase,r,t),z(s.variantToBase,t.toLowerCase(),t),z(s.variantToBase,t,t);const i=C(t);if(i!==t){z(s.variantToBase,i,t),z(s.variantToBase,i.toLowerCase(),t);const c=e.normalize(i);c!==i.toLowerCase()&&z(s.variantToBase,c,t)}if(a.has("partial-words")&&e.getWordVariants(t).forEach(l=>{z(s.variantToBase,l,t)}),a.has("phonetic")&&e.supportedFeatures.includes("phonetic")){const c=e.getPhoneticCode(t);c&&z(s.phoneticToBase,c,t)}if(O(r,n.ngramSize).forEach(c=>{z(s.ngramIndex,c,t)}),a.has("compound")&&e.supportedFeatures.includes("compound")&&e.splitCompoundWords(t).forEach(l=>{l!==t&&z(s.variantToBase,e.normalize(l),t)}),a.has("synonyms")&&(e.getSynonyms(r).forEach(l=>{z(s.synonymMap,l,t)}),n.customSynonyms)){const l=n.customSynonyms[r];l&&l.forEach(h=>{z(s.synonymMap,h,t)})}}function He(t,e,s,n,a,r,i){const o=n.normalize(t);b(a.variantToBase,o,e),b(a.variantToBase,t.toLowerCase(),e),b(a.variantToBase,t,e);const c=C(t);if(c!==t){b(a.variantToBase,c,e),b(a.variantToBase,c.toLowerCase(),e);const h=n.normalize(c);h!==c.toLowerCase()&&b(a.variantToBase,h,e)}if(i.has("partial-words")&&n.getWordVariants(t).forEach(u=>{b(a.variantToBase,u,e)}),i.has("phonetic")&&n.supportedFeatures.includes("phonetic")){const h=n.getPhoneticCode(t);h&&b(a.phoneticToBase,h,e)}if(O(o,r.ngramSize).forEach(h=>{b(a.ngramIndex,h,e)}),i.has("compound")&&n.supportedFeatures.includes("compound")&&n.splitCompoundWords(t).forEach(u=>{u.length>=r.minQueryLength&&(b(a.variantToBase,u,e),b(a.variantToBase,n.normalize(u),e))}),i.has("synonyms")&&(n.getSynonyms(o).forEach(u=>{b(a.synonymMap,u,e)}),r.customSynonyms)){const u=r.customSynonyms[o];u&&u.forEach(d=>{b(a.synonymMap,d,e)})}}function b(t,e,s,n){t.has(e)||t.set(e,new Set),t.get(e).add(s)}function z(t,e,s){t.has(e)||t.set(e,new Set),t.get(e).add(s)}function $e(t,e,s,n={}){const a={},r=[...new Set(e)];for(const i of r)a[i]=D(t,i,s,n);return a}function D(t,e,s,n={}){const a=t.config,r=s||n.maxResults||a.maxResults,i=n.fuzzyThreshold||a.fuzzyThreshold;if(!e||e.trim().length<a.minQueryLength)return[];const o=Fe(e);if(o.hasPhrases)return Ve(t,o,r,i,n);let c=e;if(a.enableStopWords&&a.stopWords&&a.stopWords.length>0&&(c=q(e,a.stopWords)),t._cache){const g=t._cache.get(c,r,n);if(g)return g}const h=(n.languages||a.languages).map(g=>t.languageProcessors.get(g)).filter(g=>g!==void 0);if(h.length===0)return[];if(t.invertedIndex&&t.documents){const g=Ge(t,c,r,i,h,n);return t._cache&&t._cache.set(c,g,r,n),g}const u=new Map;for(const g of h){const f=g.normalize(c.trim());re(f,t,u,g.language),oe(f,t,u,g.language),ie(f,g,t,u),Ke(f,t,u),ce(f,t,u,g.language,a.ngramSize),(a.features.includes("missing-letters")||a.features.includes("extra-letters")||a.features.includes("transpositions"))&&le(f,t,u,g,a)}const d=Array.from(u.values()).map(g=>B(g,c,i,t,n)).filter(g=>g!==null).sort((g,f)=>f.score-g.score).slice(0,r);return t._cache&&t._cache.set(c,d,r,n),d}function re(t,e,s,n){const a=e.config.wordBoundaries||!1;if(t.includes("*")){for(const o of e.base)se(o,t)&&(s.has(o)||s.set(o,{word:o,normalized:t,matchType:"exact",editDistance:0,language:n}));return}const r=e.variantToBase.get(t);r&&r.forEach(o=>{if(a&&!N(o,t,a))return;const c=s.get(o);(!c||c.matchType!=="exact")&&s.set(o,{word:o,normalized:t,matchType:"exact",editDistance:0,language:n})});const i=t.toLowerCase();for(const o of e.base)o.toLowerCase()===i&&(s.has(o)||s.set(o,{word:o,normalized:t,matchType:"exact",editDistance:0,language:n}))}function oe(t,e,s,n){const a=e.config.wordBoundaries||!1;for(const[r,i]of e.variantToBase.entries())r.startsWith(t)&&r!==t&&i.forEach(o=>{a&&!N(o,t,a)||s.has(o)||s.set(o,{word:o,normalized:r,matchType:"prefix",language:n})})}function ie(t,e,s,n){if(!e.supportedFeatures.includes("phonetic"))return;const a=e.getPhoneticCode(t);if(a){const r=s.phoneticToBase.get(a);r&&r.forEach(i=>{n.has(i)||n.set(i,{word:i,normalized:t,matchType:"phonetic",phoneticCode:a,language:e.language})})}}function Ke(t,e,s){const n=e.synonymMap.get(t);n&&n.forEach(a=>{s.has(a)||s.set(a,{word:a,normalized:t,matchType:"synonym",language:"synonym"})})}function ce(t,e,s,n,a){if(t.length<a)return;const r=O(t,a),i=new Set;r.forEach(o=>{const c=e.ngramIndex.get(o);c&&c.forEach(l=>i.add(l))}),i.forEach(o=>{s.has(o)||s.set(o,{word:o,normalized:t,matchType:"ngram",language:n})})}function le(t,e,s,n,a){const r=a.maxEditDistance;for(const[i,o]of e.variantToBase.entries())if(Math.abs(i.length-t.length)<=r){const l=e.config.features?.includes("transpositions")?M(t,i,r):S(t,i,r);l<=r&&o.forEach(h=>{const u=s.get(h);(!u||u.matchType!=="exact"&&u.matchType!=="prefix"&&(u.editDistance||1/0)>l)&&s.set(h,{word:h,normalized:i,matchType:"fuzzy",editDistance:l,language:n.language})})}}function B(t,e,s,n,a){let r=Qe(t,e);if(t.fieldWeight&&(r=Math.min(1,r*t.fieldWeight)),r<s)return null;const i={display:t.word,baseWord:t.word,isSynonym:t.matchType==="synonym",score:r,language:t.language,_debug_matchType:t.matchType};return n.fieldData&&n.fieldData.has(t.word)&&(i.fields=n.fieldData.get(t.word),i.field=t.field),a?.includeHighlights&&(i.highlights=V(t,e,t.word)),i}function Qe(t,e){const s=e.length,n=t.word.length,a=Math.max(s,n);let r=.5;switch(t.matchType){case"exact":r=1;break;case"prefix":r=.9-(n-s)/(a*2);break;case"substring":r=.8;break;case"phonetic":r=.7;break;case"fuzzy":t.editDistance!==void 0&&(r=Math.max(.3,1-t.editDistance/a));break;case"synonym":r=.6;break;case"compound":r=.75;break;case"ngram":r=F(e.toLowerCase(),t.normalized,3)*.8;break}return n<=s+2&&t.matchType!=="exact"&&(r+=.1),Math.min(1,Math.max(0,r))}function O(t,e){if(t.length<e)return[t];const s=[];for(let n=0;n<=t.length-e;n++)s.push(t.slice(n,n+e));return s}function Ge(t,e,s,n,a,r){if(!t.invertedIndex||!t.documents)throw new Error("Inverted index not available");return me(t.invertedIndex,t.documents,e,a,t.config).map(c=>B(c,e,n,t,r)).filter(c=>c!==null).sort((c,l)=>l.score-c.score).slice(0,s)}function Ve(t,e,s,n,a){const r=t.config,o={exactMatch:!1,maxEditDistance:1,proximityBonus:1.5,maxProximityDistance:3,useTranspositions:r.features.includes("transpositions")},c=new Map;for(const d of e.phrases)for(const g of t.base){const f=Ne(g,d,o);if(f.matched){const p=c.get(g),y=f.score*o.proximityBonus;p?c.set(g,{score:Math.max(p.score,y),phraseCount:p.phraseCount+1}):c.set(g,{score:y,phraseCount:1})}}let l=new Map;if(e.terms.length>0){const d=e.terms.join(" "),g=r.languages.map(f=>t.languageProcessors.get(f)).filter(f=>f!==void 0);for(const f of g){const p=f.normalize(d);re(p,t,l,f.language),oe(p,t,l,f.language),ie(p,f,t,l),ce(p,t,l,f.language,r.ngramSize),(r.features.includes("missing-letters")||r.features.includes("extra-letters")||r.features.includes("transpositions"))&&le(p,t,l,f,r)}}const h=new Map;for(const[d,g]of c.entries()){const f={display:d,baseWord:d,isSynonym:!1,score:g.score};l.get(d)&&(f.score=Math.min(1,f.score*1.2)),h.set(d,f)}for(const[d,g]of l.entries())if(!h.has(d)){const f=B(g,e.terms.join(" "),n,t,a);f&&(f.score*=.8,h.set(d,f))}const u=Array.from(h.values()).filter(d=>d.score>=n).sort((d,g)=>g.score-d.score).slice(0,s);return t._cache&&t._cache.set(e.original,u,s,a),u}function R(t){const e={version:"1.0",base:t.base,variantToBase:Array.from(t.variantToBase.entries()).map(([s,n])=>[s,Array.from(n)]),phoneticToBase:Array.from(t.phoneticToBase.entries()).map(([s,n])=>[s,Array.from(n)]),ngramIndex:Array.from(t.ngramIndex.entries()).map(([s,n])=>[s,Array.from(n)]),synonymMap:Array.from(t.synonymMap.entries()).map(([s,n])=>[s,Array.from(n)]),config:t.config,languageProcessorNames:Array.from(t.languageProcessors.keys())};return t.invertedIndex&&(e.invertedIndex={termToPostings:Array.from(t.invertedIndex.termToPostings.entries()),phoneticToPostings:Array.from(t.invertedIndex.phoneticToPostings.entries()),ngramToPostings:Array.from(t.invertedIndex.ngramToPostings.entries()),synonymToPostings:Array.from(t.invertedIndex.synonymToPostings.entries()),totalDocs:t.invertedIndex.totalDocs,avgDocLength:t.invertedIndex.avgDocLength}),t.documents&&(e.documents=t.documents),JSON.stringify(e)}async function he(t){const e=JSON.parse(t),s=new Map(e.variantToBase.map(([l,h])=>[l,new Set(h)])),n=new Map(e.phoneticToBase.map(([l,h])=>[l,new Set(h)])),a=new Map(e.ngramIndex.map(([l,h])=>[l,new Set(h)])),r=new Map(e.synonymMap.map(([l,h])=>[l,new Set(h)])),{LanguageRegistry:i}=await Promise.resolve().then(()=>ge),o=new Map;for(const l of e.languageProcessorNames){const h=i.getProcessor(l);h&&o.set(l,h)}const c={base:e.base,variantToBase:s,phoneticToBase:n,ngramIndex:a,synonymMap:r,languageProcessors:o,config:e.config};if(e.invertedIndex&&(c.invertedIndex={termToPostings:new Map(e.invertedIndex.termToPostings),phoneticToPostings:new Map(e.invertedIndex.phoneticToPostings),ngramToPostings:new Map(e.invertedIndex.ngramToPostings),synonymToPostings:new Map(e.invertedIndex.synonymToPostings),totalDocs:e.invertedIndex.totalDocs,avgDocLength:e.invertedIndex.avgDocLength}),e.documents&&(c.documents=e.documents),e.config.enableCache!==!1){const l=e.config.cacheSize||100;c._cache=new j(l)}return c}function Je(t,e="fuzzy-search-index"){if(typeof localStorage>"u")throw new Error("localStorage is not available");const s=R(t);localStorage.setItem(e,s)}async function Ye(t="fuzzy-search-index"){if(typeof localStorage>"u")throw new Error("localStorage is not available");const e=localStorage.getItem(t);return e?await he(e):null}function Xe(t){const e=R(t);return new Blob([e]).size}function _(t,e={}){const{minLength:s=2,splitWords:n=!0,stopWords:a=!1,overlap:r=0,chunkSize:i=0,splitOn:o="word",format:c="string",removeNumbers:l=!1,caseSensitive:h=!1}=e;let u=t;switch(c){case"base64":try{u=atob(t)}catch(g){return console.error("Failed to decode base64:",g),[]}break;case"html":u=Ze(t);break;case"json":u=qe(t);break;case"url":throw new Error("URL format requires async. Use dataToIndexAsync() instead.")}i>0&&(u=et(u,i,r,o).join(" "));let d=[];if(n?d=u.split(/[\s\-_.,;:!?()[\]{}'"\/\\]+/).filter(g=>g.length>0):d=[u],d=d.map(g=>(g=g.replace(/^[^\p{L}\p{N}]+|[^\p{L}\p{N}]+$/gu,""),h||(g=g.toLowerCase()),g)).filter(g=>!(g.length<s||l&&/^\d+$/.test(g))),a&&Array.isArray(a)){const g=new Set(a.map(f=>f.toLowerCase()));d=d.filter(f=>!g.has(f.toLowerCase()))}return Array.from(new Set(d))}function Ze(t){let e=t.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi," ");return e=e.replace(/<style\b[^<]*(?:(?!<\/style>)<[^<]*)*<\/style>/gi," "),e=e.replace(/<!--[\s\S]*?-->/g," "),e=e.replace(/<[^>]+>/g," "),e=e.replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&apos;/g,"'"),e=e.replace(/\s+/g," ").trim(),e}function qe(t){try{let e=function(a,r=0){r>10||(typeof a=="string"?n.push(a):Array.isArray(a)?a.forEach(i=>e(i,r+1)):typeof a=="object"&&a!==null&&Object.values(a).forEach(i=>e(i,r+1)))};const s=JSON.parse(t),n=[];return e(s),n.join(" ")}catch(e){return console.error("Failed to parse JSON:",e),""}}function et(t,e,s,n){const a=[];if(n==="paragraph"){const r=t.split(/\n\n+/);let i="";for(const o of r)(i+o).length<=e?i+=(i?`

`:"")+o:(i&&a.push(i),i=o);i&&a.push(i)}else if(n==="sentence"){const r=t.split(/[.!?]+\s+/);let i="";for(const o of r)(i+o).length<=e?i+=(i?" ":"")+o:(i&&a.push(i),i=o);i&&a.push(i)}else{const r=t.split(/\s+/);let i="";for(const o of r)(i+" "+o).length<=e?i+=(i?" ":"")+o:(i&&a.push(i),s>0&&i?i=i.split(/\s+/).slice(-Math.ceil(s/10)).join(" ")+" "+o:i=o);i&&a.push(i)}return a}async function tt(t,e={}){const{format:s="string"}=e;if(s==="url")try{const a=await(await fetch(t)).text();return _(a,{...e,format:"html"})}catch(n){return console.error("Failed to fetch URL:",n),[]}return _(t,e)}function nt(t,e={}){const s=ae(t,{config:{languages:e.languages||["german"],performance:e.performance||"balanced",maxResults:e.maxResults||5}});return{search:(n,a)=>D(s,n,a),index:s}}const st="1.0.2";m.BaseLanguageProcessor=T,m.DEFAULT_CONFIG=k,m.DEFAULT_STOP_WORDS=Z,m.EnglishProcessor=W,m.FrenchProcessor=A,m.GermanProcessor=L,m.LRUCache=Y,m.LanguageRegistry=x,m.PERFORMANCE_CONFIGS=U,m.SearchCache=j,m.SpanishProcessor=I,m.VERSION=st,m.areStringsSimilar=fe,m.batchSearch=$e,m.buildFuzzyIndex=ae,m.calculateDamerauLevenshteinDistance=M,m.calculateHighlights=V,m.calculateLevenshteinDistance=S,m.calculateNgramSimilarity=F,m.createFuzzySearch=nt,m.dataToIndex=_,m.dataToIndexAsync=tt,m.deserializeIndex=he,m.distanceToSimilarity=Q,m.filterStopWords=q,m.findWordBoundaryMatches=ne,m.formatHighlightedHTML=Ce,m.getAccentVariants=Ee,m.getSerializedSize=Xe,m.getStopWordsForLanguages=Ie,m.getSuggestions=D,m.hasAccents=Pe,m.isStopWord=Ae,m.isWordBoundary=ee,m.loadIndexFromLocalStorage=Ye,m.matchesAtWordBoundary=te,m.matchesWildcard=se,m.matchesWord=N,m.mergeConfig=$,m.normalizeForComparison=Me,m.removeAccents=C,m.saveIndexToLocalStorage=Je,m.serializeIndex=R,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})}));
//# sourceMappingURL=fuzzyfindjs.min.js.map
